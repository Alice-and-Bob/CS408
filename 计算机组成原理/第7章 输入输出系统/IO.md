# 外部设备  
## 显示器  
显示存储器：为了正常连贯显示，必须要把至少一帧的图像信息存储在显示存储器中。因此显存容量最小要存一帧图像，大小至少为：显示单元个数（分辨率）× 单个单元所需数据大小（颜色深度位数）  
## 磁盘
- 组成：若干个盘片组成阵列，每个盘片划分为若干同心圆称为磁道；再沿半径方向划分为若干个扇区，磁盘按块/扇区存取
- 平均存取时间：寻道时间（磁头移动到相应磁道的耗时）+旋转延迟时间（扇区转到磁头下的耗时，一般情况下认为是磁盘转半圈的时间）+传输时间（数据传输时间）+【控制电路的延时】  
- 磁盘阵列RAID：RAID0扩大了存储容量和存取速度但没有容错能力；RAID1简单复制磁盘内容，有基础的容错能力  

## IO接口
- 接口和端口：端口=寄存器；接口=若干寄存器+控制电路  

## IO方式
### 程序查询方式：
- CPU执行初始化程序，预置传送参数；向IO接口发送命令字，启动IO设备；不断查询IO接口的设备状态寄存器来等待IO准备好数据；  
- 特点是CPU忙等，一直查询IO接口状态使得CPU无法执行其他指令 
### 程序中断方式：
- CPU安排启动外设，之后转去执行其他指令，当外部设备准备好数据，主动向CPU发出中断请求，请求CPU时间；CPU一旦同意请求，将暂时中止正在执行的程序，转入中断服务程序为外设服务；服务结束后CPU继续执行原来的指令  
- 中断请求：
  - 内中断、外中断
    - 内中断：在处理器和内存内部产生的中断，包括各种计算错误、内部设备损坏、用户执行特权指令（自陷）、用户态到核心态的切换
    - 外中断：来自外设的中断，可以是IO设备的中断、时钟中断、外部信号中断
  - 硬件中断、软件中断
    - 硬件中断：外部硬件产生的中断，属于外中断
    - 软件中断：通过某条指令产生的中断，属于内中断
  - 非屏蔽中断、可屏蔽中断
    - 非屏蔽中断：硬件中断，不受CPU关中断影响
    - 可屏蔽中断：硬件中断，在CPU关中断IF=0时不被CPU相应  
- 中断隐指令：
  - 关中断
  - 保存断点：PC寄存器
  - 引出中断服务程序：中断服务程序地址→PC寄存器
> 中断隐指令是有**硬件完成**的，不需要执行代码  
- 中断流程：
  - 关中断：防止保存断点的时候被新的中断打断
  - 保存断点：保存PC寄存器的值
  - 引出中断服务程序：找到中断服务程序的地址送到PC寄存器中，开始执行中断服务程序
  - 保存现场和屏蔽字：**中断服务程序来保存现场**
  - 开中断：中断嵌套
  - 执行中断服务程序
  - 关中断：中断服务程序执行完备，保证在恢复现场和屏蔽字的时候不被打断
  - 恢复现场和屏蔽字
  - 开中断、中断返回
> 保存现场和恢复现场都由中断服务程序进行，而程序断点由硬件执行中断隐指令完成
- 多级中断嵌套和屏蔽字
  - 指可否相互屏蔽，例如A>B，则A执行过程屏蔽了B，不会因为B而中断；反之B可以被A的出现打断  
  

### DMA方式
- DMA流程
  - 接受外设发出的DMA请求，并向CPU请求总线使用权
  - CPU同意，让出总线控制权，进入DMA周期
  - 确定传送数据的主存单元地址和长度，自动修改主存地址计数和传送长度计数
  - 根据数据传送的方向，发出读/写控制信号，传送一定长度数据
  - 重复以上过程，直到全部数据传送完成，向CPU发送中断，通知CPU完成数据传送；由CPU完成后处理
- 特点：
  - 硬件执行，无需CPU时间
  - 只要CPU不占用总线就能响应DMA请求
  - DMA只能传输数据，没有异常事件处理能力